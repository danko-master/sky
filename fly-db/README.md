# БД Обработки полётов

## Запуск

```
sudo docker-compose up
```

В фоновом режиме

```
sudo docker-compose up -d
```

Удалить все компоненты (Network, Volume, Container):

```
sudo docker-compose down -v
```

## pgAdmin

Расскоментировать нужный блок в docker-compose.
При запуске станет доступен pgAdmin.

Адрес pgAdmin:
http://localhost:5501/
http://127.0.0.1:5501/
http://0.0.0.0:5501/

# БД

## PSQL

```
sudo docker exec -it pg_fly_data_container bash
root@1cbdd5c24ed1:/#
export PGPASSWORD='extR3@der'; psql -U teleuser -d pegasdb
```

## IP адрес БД

```
sudo docker inspect \
 -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' pg_fly_data_container
```

## Таблицы

### xlsxfiles

| Наименование | Тип поля  | Описание                                                                                                      |
| ------------ | --------- | ------------------------------------------------------------------------------------------------------------- |
| id           | INT       | Уникальный идентификатор в данной таблице                                                                     |
| uuid         | UUID      | Уникальный идентификатор файла. Используется в качестве сквозного идентификатора и названия файла в хранилище |
| statusCode   | VARCHAR   | Статус обработки                                                                                              |
| bucket       | VARCHAR   | Используется в хранилище для объединения файлов (аналог папки)                                                |
| originalName | VARCHAR   | Оригинальное название файла                                                                                   |
| originalSize | INT       | Размер оригинального файла                                                                                    |
| createdAt    | TIMESTAMP | Дата загрузки файла в систему                                                                                 |
| updatedAt    | TIMESTAMP | Дата обновления информации                                                                                    |

### Статусы xlsxfiles

| status_code | Имя                          | Описание                                             |
| ----------- | ---------------------------- | ---------------------------------------------------- |
| uploaded    | Готов к обработке            | Ожидает чтения Обработчиком файла                    |
| reading     | Чтение файла                 | Файл читается обработчиком для подготовки к парсингу |
| \* readed   | Готов к парсингу             | Ожидает процесс парсинга каждого поля                |
| parsing     | В процессе парсинга          | Происходит процесс парсинга каждого поля             |
| \* parsed   | Готов к сохранению           | Ожидает/происходит процесс сохранения каждого поля   |
| \* saving   | В процессе сохранения        | Происходит процесс сохранения каждого поля           |
| saved       | Готов к формированию отчётов | Все поля обработаны и сохранены в отчётной БД        |

\* статусы для целевой архитектуры, при масштабировании системы (в существующей версии не испоьзуются)
